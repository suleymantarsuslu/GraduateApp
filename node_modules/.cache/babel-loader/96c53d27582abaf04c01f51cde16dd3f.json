{"ast":null,"code":"\"use strict\";\n\nvar get = require(\"lodash.get\");\n\nvar Errors = require(\"./Errors\");\n\nvar Utils = require(\"./Utils\");\n/**\n * @class\n *\n * @param {Report|object} parentOrOptions\n * @param {object} [reportOptions]\n */\n\n\nfunction Report(parentOrOptions, reportOptions) {\n  this.parentReport = parentOrOptions instanceof Report ? parentOrOptions : undefined;\n  this.options = parentOrOptions instanceof Report ? parentOrOptions.options : parentOrOptions || {};\n  this.reportOptions = reportOptions || {};\n  this.errors = [];\n  /**\n   * @type {string[]}\n   */\n\n  this.path = [];\n  this.asyncTasks = [];\n  this.rootSchema = undefined;\n  this.commonErrorMessage = undefined;\n  this.json = undefined;\n}\n/**\n * @returns {boolean}\n */\n\n\nReport.prototype.isValid = function () {\n  if (this.asyncTasks.length > 0) {\n    throw new Error(\"Async tasks pending, can't answer isValid\");\n  }\n\n  return this.errors.length === 0;\n};\n/**\n *\n * @param {*} fn\n * @param {*} args\n * @param {*} asyncTaskResultProcessFn\n */\n\n\nReport.prototype.addAsyncTask = function (fn, args, asyncTaskResultProcessFn) {\n  this.asyncTasks.push([fn, args, asyncTaskResultProcessFn]);\n};\n\nReport.prototype.getAncestor = function (id) {\n  if (!this.parentReport) {\n    return undefined;\n  }\n\n  if (this.parentReport.getSchemaId() === id) {\n    return this.parentReport;\n  }\n\n  return this.parentReport.getAncestor(id);\n};\n/**\n *\n * @param {*} timeout\n * @param {function(*, *)} callback\n *\n * @returns {void}\n */\n\n\nReport.prototype.processAsyncTasks = function (timeout, callback) {\n  var validationTimeout = timeout || 2000,\n      tasksCount = this.asyncTasks.length,\n      idx = tasksCount,\n      timedOut = false,\n      self = this;\n\n  function finish() {\n    process.nextTick(function () {\n      var valid = self.errors.length === 0,\n          err = valid ? null : self.errors;\n      callback(err, valid);\n    });\n  }\n\n  function respond(asyncTaskResultProcessFn) {\n    return function (asyncTaskResult) {\n      if (timedOut) {\n        return;\n      }\n\n      asyncTaskResultProcessFn(asyncTaskResult);\n\n      if (--tasksCount === 0) {\n        finish();\n      }\n    };\n  } // finish if tasks are completed or there are any errors and breaking on first error was requested\n\n\n  if (tasksCount === 0 || this.errors.length > 0 && this.options.breakOnFirstError) {\n    finish();\n    return;\n  }\n\n  while (idx--) {\n    var task = this.asyncTasks[idx];\n    task[0].apply(null, task[1].concat(respond(task[2])));\n  }\n\n  setTimeout(function () {\n    if (tasksCount > 0) {\n      timedOut = true;\n      self.addError(\"ASYNC_TIMEOUT\", [tasksCount, validationTimeout]);\n      callback(self.errors, false);\n    }\n  }, validationTimeout);\n};\n/**\n *\n * @param {*} returnPathAsString\n *\n * @return {string[]|string}\n */\n\n\nReport.prototype.getPath = function (returnPathAsString) {\n  /**\n   * @type {string[]|string}\n   */\n  var path = [];\n\n  if (this.parentReport) {\n    path = path.concat(this.parentReport.path);\n  }\n\n  path = path.concat(this.path);\n\n  if (returnPathAsString !== true) {\n    // Sanitize the path segments (http://tools.ietf.org/html/rfc6901#section-4)\n    path = \"#/\" + path.map(function (segment) {\n      segment = segment.toString();\n\n      if (Utils.isAbsoluteUri(segment)) {\n        return \"uri(\" + segment + \")\";\n      }\n\n      return segment.replace(/\\~/g, \"~0\").replace(/\\//g, \"~1\");\n    }).join(\"/\");\n  }\n\n  return path;\n};\n\nReport.prototype.getSchemaId = function () {\n  if (!this.rootSchema) {\n    return null;\n  } // get the error path as an array\n\n\n  var path = [];\n\n  if (this.parentReport) {\n    path = path.concat(this.parentReport.path);\n  }\n\n  path = path.concat(this.path); // try to find id in the error path\n\n  while (path.length > 0) {\n    var obj = get(this.rootSchema, path);\n\n    if (obj && obj.id) {\n      return obj.id;\n    }\n\n    path.pop();\n  } // return id of the root\n\n\n  return this.rootSchema.id;\n};\n/**\n *\n * @param {*} errorCode\n * @param {*} params\n *\n * @return {boolean}\n */\n\n\nReport.prototype.hasError = function (errorCode, params) {\n  var idx = this.errors.length;\n\n  while (idx--) {\n    if (this.errors[idx].code === errorCode) {\n      // assume match\n      var match = true; // check the params too\n\n      var idx2 = this.errors[idx].params.length;\n\n      while (idx2--) {\n        if (this.errors[idx].params[idx2] !== params[idx2]) {\n          match = false;\n        }\n      } // if match, return true\n\n\n      if (match) {\n        return match;\n      }\n    }\n  }\n\n  return false;\n};\n/**\n *\n * @param {*} errorCode\n * @param {*} params\n * @param {Report[]|Report} [subReports]\n * @param {*} [schema]\n *\n * @return {void}\n */\n\n\nReport.prototype.addError = function (errorCode, params, subReports, schema) {\n  if (!errorCode) {\n    throw new Error(\"No errorCode passed into addError()\");\n  }\n\n  this.addCustomError(errorCode, Errors[errorCode], params, subReports, schema);\n};\n\nReport.prototype.getJson = function () {\n  var self = this;\n\n  while (self.json === undefined) {\n    self = self.parentReport;\n\n    if (self === undefined) {\n      return undefined;\n    }\n  }\n\n  return self.json;\n};\n/**\n *\n * @param {*} errorCode\n * @param {*} errorMessage\n * @param {*[]} params\n * @param {Report[]|Report} subReports\n * @param {*} schema\n *\n * @returns {void}\n */\n\n\nReport.prototype.addCustomError = function (errorCode, errorMessage, params, subReports, schema) {\n  if (this.errors.length >= this.reportOptions.maxErrors) {\n    return;\n  }\n\n  if (!errorMessage) {\n    throw new Error(\"No errorMessage known for code \" + errorCode);\n  }\n\n  params = params || [];\n  var idx = params.length;\n\n  while (idx--) {\n    var whatIs = Utils.whatIs(params[idx]);\n    var param = whatIs === \"object\" || whatIs === \"null\" ? JSON.stringify(params[idx]) : params[idx];\n    errorMessage = errorMessage.replace(\"{\" + idx + \"}\", param);\n  }\n\n  var err = {\n    code: errorCode,\n    params: params,\n    message: errorMessage,\n    path: this.getPath(this.options.reportPathAsArray),\n    schemaId: this.getSchemaId()\n  };\n  err[Utils.schemaSymbol] = schema;\n  err[Utils.jsonSymbol] = this.getJson();\n\n  if (schema && typeof schema === \"string\") {\n    err.description = schema;\n  } else if (schema && typeof schema === \"object\") {\n    if (schema.title) {\n      err.title = schema.title;\n    }\n\n    if (schema.description) {\n      err.description = schema.description;\n    }\n  }\n\n  if (subReports != null) {\n    if (!Array.isArray(subReports)) {\n      subReports = [subReports];\n    }\n\n    err.inner = [];\n    idx = subReports.length;\n\n    while (idx--) {\n      var subReport = subReports[idx],\n          idx2 = subReport.errors.length;\n\n      while (idx2--) {\n        err.inner.push(subReport.errors[idx2]);\n      }\n    }\n\n    if (err.inner.length === 0) {\n      err.inner = undefined;\n    }\n  }\n\n  this.errors.push(err);\n};\n\nmodule.exports = Report;","map":{"version":3,"sources":["/Users/suleymantarsuslu/Desktop/graduateApp/new/graduate/node_modules/z-schema/src/Report.js"],"names":["get","require","Errors","Utils","Report","parentOrOptions","reportOptions","parentReport","undefined","options","errors","path","asyncTasks","rootSchema","commonErrorMessage","json","prototype","isValid","length","Error","addAsyncTask","fn","args","asyncTaskResultProcessFn","push","getAncestor","id","getSchemaId","processAsyncTasks","timeout","callback","validationTimeout","tasksCount","idx","timedOut","self","finish","process","nextTick","valid","err","respond","asyncTaskResult","breakOnFirstError","task","apply","concat","setTimeout","addError","getPath","returnPathAsString","map","segment","toString","isAbsoluteUri","replace","join","obj","pop","hasError","errorCode","params","code","match","idx2","subReports","schema","addCustomError","getJson","errorMessage","maxErrors","whatIs","param","JSON","stringify","message","reportPathAsArray","schemaId","schemaSymbol","jsonSymbol","description","title","Array","isArray","inner","subReport","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar get    = require(\"lodash.get\");\nvar Errors = require(\"./Errors\");\nvar Utils  = require(\"./Utils\");\n\n/**\n * @class\n *\n * @param {Report|object} parentOrOptions\n * @param {object} [reportOptions]\n */\nfunction Report(parentOrOptions, reportOptions) {\n    this.parentReport = parentOrOptions instanceof Report ?\n                            parentOrOptions :\n                            undefined;\n\n    this.options = parentOrOptions instanceof Report ?\n                       parentOrOptions.options :\n                       parentOrOptions || {};\n\n    this.reportOptions = reportOptions || {};\n\n    this.errors = [];\n    /**\n     * @type {string[]}\n     */\n    this.path = [];\n    this.asyncTasks = [];\n\n    this.rootSchema = undefined;\n    this.commonErrorMessage = undefined;\n    this.json = undefined;\n}\n\n/**\n * @returns {boolean}\n */\nReport.prototype.isValid = function () {\n    if (this.asyncTasks.length > 0) {\n        throw new Error(\"Async tasks pending, can't answer isValid\");\n    }\n    return this.errors.length === 0;\n};\n\n/**\n *\n * @param {*} fn\n * @param {*} args\n * @param {*} asyncTaskResultProcessFn\n */\nReport.prototype.addAsyncTask = function (fn, args, asyncTaskResultProcessFn) {\n    this.asyncTasks.push([fn, args, asyncTaskResultProcessFn]);\n};\n\nReport.prototype.getAncestor = function (id) {\n    if (!this.parentReport) {\n        return undefined;\n    }\n    if (this.parentReport.getSchemaId() === id) {\n        return this.parentReport;\n    }\n    return this.parentReport.getAncestor(id);\n};\n\n/**\n *\n * @param {*} timeout\n * @param {function(*, *)} callback\n *\n * @returns {void}\n */\nReport.prototype.processAsyncTasks = function (timeout, callback) {\n\n    var validationTimeout = timeout || 2000,\n        tasksCount        = this.asyncTasks.length,\n        idx               = tasksCount,\n        timedOut          = false,\n        self              = this;\n\n    function finish() {\n        process.nextTick(function () {\n            var valid = self.errors.length === 0,\n                err = valid ? null : self.errors;\n            callback(err, valid);\n        });\n    }\n\n    function respond(asyncTaskResultProcessFn) {\n        return function (asyncTaskResult) {\n            if (timedOut) { return; }\n            asyncTaskResultProcessFn(asyncTaskResult);\n            if (--tasksCount === 0) {\n                finish();\n            }\n        };\n    }\n\n    // finish if tasks are completed or there are any errors and breaking on first error was requested\n    if (tasksCount === 0 || (this.errors.length > 0 && this.options.breakOnFirstError)) {\n        finish();\n        return;\n    }\n\n    while (idx--) {\n        var task = this.asyncTasks[idx];\n        task[0].apply(null, task[1].concat(respond(task[2])));\n    }\n\n    setTimeout(function () {\n        if (tasksCount > 0) {\n            timedOut = true;\n            self.addError(\"ASYNC_TIMEOUT\", [tasksCount, validationTimeout]);\n            callback(self.errors, false);\n        }\n    }, validationTimeout);\n\n};\n\n/**\n *\n * @param {*} returnPathAsString\n *\n * @return {string[]|string}\n */\nReport.prototype.getPath = function (returnPathAsString) {\n    /**\n     * @type {string[]|string}\n     */\n    var path = [];\n    if (this.parentReport) {\n        path = path.concat(this.parentReport.path);\n    }\n    path = path.concat(this.path);\n\n    if (returnPathAsString !== true) {\n        // Sanitize the path segments (http://tools.ietf.org/html/rfc6901#section-4)\n        path = \"#/\" + path.map(function (segment) {\n            segment = segment.toString();\n\n            if (Utils.isAbsoluteUri(segment)) {\n                return \"uri(\" + segment + \")\";\n            }\n\n            return segment.replace(/\\~/g, \"~0\").replace(/\\//g, \"~1\");\n        }).join(\"/\");\n    }\n    return path;\n};\n\nReport.prototype.getSchemaId = function () {\n\n    if (!this.rootSchema) {\n        return null;\n    }\n\n    // get the error path as an array\n    var path = [];\n    if (this.parentReport) {\n        path = path.concat(this.parentReport.path);\n    }\n    path = path.concat(this.path);\n\n    // try to find id in the error path\n    while (path.length > 0) {\n        var obj = get(this.rootSchema, path);\n        if (obj && obj.id) { return obj.id; }\n        path.pop();\n    }\n\n    // return id of the root\n    return this.rootSchema.id;\n};\n\n/**\n *\n * @param {*} errorCode\n * @param {*} params\n *\n * @return {boolean}\n */\nReport.prototype.hasError = function (errorCode, params) {\n    var idx = this.errors.length;\n    while (idx--) {\n        if (this.errors[idx].code === errorCode) {\n            // assume match\n            var match = true;\n\n            // check the params too\n            var idx2 = this.errors[idx].params.length;\n            while (idx2--) {\n                if (this.errors[idx].params[idx2] !== params[idx2]) {\n                    match = false;\n                }\n            }\n\n            // if match, return true\n            if (match) { return match; }\n        }\n    }\n    return false;\n};\n\n/**\n *\n * @param {*} errorCode\n * @param {*} params\n * @param {Report[]|Report} [subReports]\n * @param {*} [schema]\n *\n * @return {void}\n */\nReport.prototype.addError = function (errorCode, params, subReports, schema) {\n    if (!errorCode) { throw new Error(\"No errorCode passed into addError()\"); }\n\n    this.addCustomError(errorCode, Errors[errorCode], params, subReports, schema);\n};\n\nReport.prototype.getJson = function () {\n    var self = this;\n    while (self.json === undefined) {\n        self = self.parentReport;\n        if (self === undefined) {\n            return undefined;\n        }\n    }\n    return self.json;\n};\n\n/**\n *\n * @param {*} errorCode\n * @param {*} errorMessage\n * @param {*[]} params\n * @param {Report[]|Report} subReports\n * @param {*} schema\n *\n * @returns {void}\n */\nReport.prototype.addCustomError = function (errorCode, errorMessage, params, subReports, schema) {\n    if (this.errors.length >= this.reportOptions.maxErrors) {\n        return;\n    }\n\n    if (!errorMessage) { throw new Error(\"No errorMessage known for code \" + errorCode); }\n\n    params = params || [];\n\n    var idx = params.length;\n    while (idx--) {\n        var whatIs = Utils.whatIs(params[idx]);\n        var param = (whatIs === \"object\" || whatIs === \"null\") ? JSON.stringify(params[idx]) : params[idx];\n        errorMessage = errorMessage.replace(\"{\" + idx + \"}\", param);\n    }\n\n    var err = {\n        code: errorCode,\n        params: params,\n        message: errorMessage,\n        path: this.getPath(this.options.reportPathAsArray),\n        schemaId: this.getSchemaId()\n    };\n\n    err[Utils.schemaSymbol] = schema;\n    err[Utils.jsonSymbol] = this.getJson();\n\n    if (schema && typeof schema === \"string\") {\n        err.description = schema;\n    } else if (schema && typeof schema === \"object\") {\n        if (schema.title) {\n            err.title = schema.title;\n        }\n        if (schema.description) {\n            err.description = schema.description;\n        }\n    }\n\n    if (subReports != null) {\n        if (!Array.isArray(subReports)) {\n            subReports = [subReports];\n        }\n        err.inner = [];\n        idx = subReports.length;\n        while (idx--) {\n            var subReport = subReports[idx],\n                idx2 = subReport.errors.length;\n            while (idx2--) {\n                err.inner.push(subReport.errors[idx2]);\n            }\n        }\n        if (err.inner.length === 0) {\n            err.inner = undefined;\n        }\n    }\n\n    this.errors.push(err);\n};\n\nmodule.exports = Report;\n"]},"metadata":{},"sourceType":"script"}